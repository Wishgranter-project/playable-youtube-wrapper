(()=>{"use strict";class t extends HTMLElement{constructor(){super(),this.state={isPaused:!1,isPlaying:!1,isReproducing:!1,isBuffering:!1,isWaiting:!1,isEnded:!1,volume:100}}appendTo(t){return t.append(this),new Promise((async(t,e)=>t()))}prependTo(t){return t.prepend(this),new Promise((async(t,e)=>t()))}appendAfter(t){return t.after(this),new Promise((async(t,e)=>t()))}get isPaused(){return this.state.isPaused}get isPlaying(){return this.state.isPlaying}get isReproducing(){return this.state.isReproducing}get isWaiting(){return this.state.isWaiting}get isBuffering(){return this.state.isBuffering}get isEnded(){return this.state.isEnded}get volume(){return this.state.volume}get currentTime(){}get currentTimeFormatted(){return t.secondsToStringRepresentation(this.currentTime)}get currentTimePercentage(){var t,e;return t=Math.round(this.currentTime),e=Math.round(this.duration),isNaN(t)||isNaN(e)||0==t||0==e?0:t/e*100}get remainingTime(){return this.duration-this.currentTime}get remainingTimeFormatted(){return t.secondsToStringRepresentation(this.remainingTime)}get remainingTimePercentage(){return 100-this.currentTimePercentage}get duration(){}get durationFormatted(){return t.secondsToStringRepresentation(this.duration)}getTime(t){return Math.round(this.duration/100*t)}getTimeFormatted(e){return t.secondsToStringRepresentation(this.getTime(e))}getPercentage(e){return("string"==typeof e&&e.indexOf(":")>=0?t.stringRepresentationToSeconds(e):parseFloat(e))/this.duration*100}seek(t){}play(t=null){}pause(){}toggle(){this.isPlaying?this.pause():this.play()}sanitizeGetSeconds(e){var i;return i="string"==typeof e&&e.indexOf(":")>=0?t.stringRepresentationToSeconds(e):"string"==typeof e&&e.indexOf("%")>=0?this.getTime(parseInt(e)):"string"==typeof e?parseInt(e):e,isNaN(i)&&(i=0),i}fireEvent(t,e,i=!0){var s={bubbles:i};null!=e&&(s.detail=e);var n=new CustomEvent(t,s);return this.dispatchEvent(n)}log(t){console.log(t)}static secondsToStringRepresentation(t){return isNaN(t)?"00:00":(t=Math.round(t),a=(n=(n=(i=Math.floor(t/60))-60*(e=Math.floor(i/60)))<10?"0"+n:n)+":"+(r=(r=t-60*i)<10?"0"+r:r),a=(s=e)>0?s+":"+a:a);var e,i,s,n,r,a}static stringRepresentationToSeconds(t){var e,i,s;return!((e=t.match(/[0-9]+/g)).length>3)&&(s=parseInt(e[e.length-1]),i=parseInt(e[e.length-2]||0),3600*parseInt(e[e.length-3]||0)+60*i+s)}}const e=t;class i{constructor(t,e,i=nul){this.src=t,this.propertyToCheck=e,this.appendTo=i||document.body,this.loading=!1,this.loaded=!1}async load(){return new Promise((async(t,e)=>{var i;(i=document.createElement("script")).async=!0,i.type="text/javascript",i.onload=e=>{this.checkOnProperty(t)},i.onerror=t=>{e(this.src+" failed to load")},i.src=this.src,this.appendTo.appendChild(i)}))}checkOnProperty(t){this.waiter=setInterval((()=>{if(i.isPropertyDefined(this.propertyToCheck))return this.loaded=!0,this.loading=!1,clearInterval(this.waiter),t(this.src+" ready")}),100)}static isPropertyDefined(t,e=window){var i=t.split("."),s=e;for(var n of i)if(void 0===(s=s[n]))return!1;return!0}}const s=i,n=class{static async loadExternalJs(t,e,i=null){return new s(t,e,i).load()}};class r extends e{static sdkLoaded=!1;static sdkLoading=!1;static sdkPromise=null;static defaultSettings={width:640,height:"auto",autoplay:!1};constructor(){super(),this.state.currentTime=0,this.state.playerInitialized=!1,this.settings=r.defaultSettings,this.settings.embbedId="youtube-embbed-"+Math.floor(1e4*Math.random()),this.settings.id=null,this.html={},this.follower=null}connectedCallback(){var t,e,i,s,n;if(!this.html.embed)return this.html.embed=this.createDiv(this.settings.embbedId,this),(t=this.getAttribute("src"))&&(this.src=t),(e=this.getAttribute("video-id"))&&(this.videoId=e),(i=this.getAttribute("width"))&&(this.width=i),(s=this.getAttribute("height"))&&(this.height=s),(n=this.getAttribute("autoplay"))&&(this.autoplay=["true","1"].includes(n)),this.readyToPlayPromise=r.loadSdk().then((()=>this.initializePlayer()))}remove(){this.html.ytWidget&&this.html.ytWidget.destroy(),super.remove()}appendTo(t){return t.append(this),this.readyToPlayPromise}prependTo(t){return t.prepend(this),this.readyToPlayPromise}appendAfter(t){return t.after(this),this.readyToPlayPromise}set src(t){this.settings.id=r.getIdFromUrl(t)}set videoId(t){this.settings.id=t}set width(t){this.settings.width=t,this.updateDimensions()}set height(t){this.settings.height=t,this.updateDimensions()}set autoplay(t){this.settings.autoplay=t}calculateDimensions(){var t,e,i=this.settings.width,s=this.settings.height;return"auto"==i?t=this.parentNode.offsetWidth>400?400:this.parentNode.offsetWidth:"string"==typeof i&&i.indexOf("%")>-1?(t=parseInt(i),t=parseInt(this.parentNode.offsetWidth/100*t)):t=i,"auto"==s?e=parseInt(t/1.77):"string"==typeof s&&s.indexOf("%")>-1?(e=parseInt(s),e=parseInt(this.parentNode.offsetHeight/100*e)):e=s,{actualWidth:t,actualHeight:e}}updateDimensions(){if(this.html.ytWidget){var t=this.html.ytWidget.getIframe(),{actualWidth:e,actualHeight:i}=this.calculateDimensions();t.style.width=e+"px",t.style.height=i+"px"}}get currentTime(){return this.state.currentTime}get duration(){return this.html.ytWidget&&this.html.ytWidget.getDuration?this.html.ytWidget.getDuration():0}seek(t){if(!this.state.playerInitialized)return!1;var e=this.sanitizeGetSeconds(t);this.html.ytWidget.seekTo(e,!0)}play(t=null){return t&&this.seek(t),new Promise(((t,e)=>this.state.playerInitialized?(this.html.ytWidget.playVideo(),t()):e("Player has not been initialized")))}pause(){if(!this.state.playerInitialized)return!1;this.html.ytWidget.pauseVideo()}setVolume(t){this.state.volume=t,this.state.playerInitialized&&this.html.ytWidget.setVolume(t)}async initializePlayer(){return new Promise((async(t,e)=>{var{actualWidth:i,actualHeight:s}=this.calculateDimensions();this.html.ytWidget=new YT.Player(this.settings.embbedId,{width:i,height:s,videoId:this.settings.id,startSeconds:0,playerVars:{autoplay:this.settings.autoplay,controls:0},events:{onReady:e=>{t(this),this.setVolume(this.volume),this.state.playerInitialized=!0},onError:t=>{var i=r.getErrorDescription(t.data);e(i),this.fireEvent("playable:error",{errorCode:t.data,errorMessage:i})},onStateChange:this.callBackOnStateChange.bind(this)}})}))}callBackOnStateChange(t){switch(t.data){case-1:this.state.isReproducing=!1,this.state.isPlaying=!1,this.state.isPaused=!1;break;case 0:this.state.isReproducing=!1,this.state.isPlaying=!1,this.state.isPaused=!0,this.state.isWaiting=!1,this.state.isEnded=!0,this.stopFollowing(),this.fireEvent("playable:ended");break;case 1:var e=this.state.isWaiting;this.state.isReproducing=!0,this.state.isPlaying=!0,this.state.isPaused=!1,this.state.isBuffering=!1,this.state.isWaiting=!1,this.state.isEnded=!1,this.startFollowing(),e?this.fireEvent("playable:playing"):this.fireEvent("playable:play");break;case 2:this.state.isReproducing=!1,this.state.isPlaying=!1,this.state.isPaused=!0,this.state.isWaiting=!1,this.fireEvent("playable:pause");break;case 3:this.state.isReproducing=!1,this.state.isPlaying=!0,this.state.isPaused=!1,this.state.isBuffering=!0,this.state.isWaiting=!0,this.fireEvent("playable:waiting");break;case 5:this.play(0),this.fireEvent("playable:play")}}startFollowing(){this.follower=setInterval(this.following.bind(this),1e3)}stopFollowing(){clearInterval(this.follower)}following(){var t=this.html.ytWidget&&this.html.ytWidget.getCurrentTime?this.html.ytWidget.getCurrentTime():0;t!=this.currentTime&&(this.state.currentTime=t,this.fireEvent("playable:timeupdate"))}static getErrorDescription(t){switch(t){case"2":return"Error 2: invalid parameters.";case"5":return"Error 5: An error related to the HTML5 player occurred.";case"100":return"Error 100: Video not found.";case"101":case"150":return"Error 101: The video's owner won't allow it on embbed players."}return"Error "+t+": Unknown error"}static getIdFromUrl(t){var e;return(e=t.match(/v=([A-Za-z0-9-_]+)/))||(e=t.match(/\.be\/([A-Za-z0-9-_]+)/))||(e=t.match(/embed\/([A-Za-z0-9-_]+)/))?e[1]:null}static async loadSdk(){return r.sdkLoaded?new Promise((async(t,e)=>{t()})):r.sdkLoading?r.sdkPromise:(r.sdkLoading=!0,r.sdkPromise=new Promise((async(t,e)=>{n.loadExternalJs("https://www.youtube.com/iframe_api","YT.Player").then((()=>(r.sdkLoaded=!0,r.sdkLoading=!1,t("YouTube SDK ready"))),(()=>(r.sdkLoading=!1,e("Error loading SDK"))))})))}createDiv(t,e){var i=document.createElement("div");return i.id=t,e.append(i),i}}const a=r;function o(t){var e=document.createElement("p");e.innerHTML=t,window.logWindow.append(e)}window.PlayableYouTube=a,customElements.define("youtube-player",a),document.addEventListener("DOMContentLoaded",(function(){window.mediaPlayer=document.getElementById("media-player"),window.currentTime=document.getElementById("current-time"),window.remainingTime=document.getElementById("remaining-time"),window.progressBar=document.getElementById("progress-bar"),window.logWindow=document.querySelector("#log div"),window.wrapper=document.getElementById("youtube-wrapper"),window.volume=15,document.getElementById("toggle-play-pause").addEventListener("click",(function(){window.player.toggle()})),document.querySelectorAll("#media-list a").forEach((function(t){t.addEventListener("click",(function(e){var i,s;e.preventDefault(),window.player&&(window.player.pause(),window.player.remove()),window.player=(i=this.attributes.href.value,(s=document.createElement("youtube-player")).src=i,s.width="100%",s.addEventListener("playable:play",(function(){o("Play")})),s.addEventListener("playable:pause",(function(){o("Pause")})),s.addEventListener("playable:ended",(function(){o("Ended")})),s.addEventListener("playable:timeupdate",(function(){window.currentTime.innerHTML=this.currentTimeFormatted,window.remainingTime.innerHTML=this.remainingTimeFormatted,window.progressBar.value=this.currentTimePercentage})),s.addEventListener("playable:waiting",(function(){window.mediaPlayer.classList.add("waiting"),o("Waiting")})),s.addEventListener("playable:playing",(function(){window.mediaPlayer.classList.remove("waiting"),o("Playing")})),s.addEventListener("playable:error",(function(t){o(t.detail.errorMessage)})),s),window.player.appendTo(window.wrapper).then((()=>{window.player.setVolume(window.volume),window.player.play()})),document.getElementById("title").innerHTML=t.querySelector(":scope .title").innerHTML,document.getElementById("artist").innerHTML=t.querySelector(":scope .artist").innerHTML}))})),document.getElementById("progress-bar").addEventListener("click",(function(t){var e,i,s;e=t.clientX-this.offsetLeft,i=this.offsetWidth,s=Math.ceil(e/i*100)+"%",window.player.seek(s)})),document.getElementById("volume-slider").value=window.volume,document.getElementById("volume-slider").addEventListener("change",(function(){window.volume=parseInt(this.value),window.player.setVolume(window.volume)}))}))})();